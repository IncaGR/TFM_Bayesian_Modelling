#                          "sant pere - santa caterina i la ribera",shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "el poble sec - parc de montjuïc",
#                          "el poble-sec", shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "vila de gràcia", "la vila de gràcia",shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "la marina del port", "la marina del port", shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "vallvidrera - el tibidabo i les planes",
#                          "vallvidrera, el tibidabo i les planes", shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "el besòs", "el besòs i el maresme", shape_nom_barri),
key_open = ifelse(regex_barris == "besòs", "besòs maresme", key_open),
key_open = ifelse(regex_barris == "can peguera turó peira", "can peguera",
key_open), # recuerda que idealista estan juntos, shp dos barrios distintos
key_open = ifelse(regex_barris == "ciutat meridiana torre baró vallbona",
"ciutat meridiana", key_open),
key_open = ifelse(regex_barris ==  "sant genís agudells montbau",
"montbau", key_open),
key_open = ifelse(regex_barris == "vall hebron clota", "vall hebron", key_open),
key_open = ifelse(regex_barris == "poble sec parc montjuïc", "poble sec", key_open)
)
# to connect Idealista data and shp file the key is: key_shp
data_idealista = data_idealista %>%
mutate(key_shp = regex_barris)
data_idealista = data_idealista %>%
dplyr::rename(nombre = X.U.FEFF.name)
ggplot(data_idealista,aes(square_mt,price)) +
geom_jitter()
data_idealista = data_idealista[data_idealista$price<70000,]
data_idealista = data_idealista[data_idealista$square_mt>10,] # casa con 0 metros, eliminada
## Adding new binary variables
data_idealista = data_idealista %>%
mutate(casa = ifelse(grepl("Casa o chalet",data_idealista$nombre)==TRUE,1,0))
data_idealista = data_idealista %>%
mutate(estudio = ifelse(grepl("Estudio",data_idealista$nombre)==TRUE,1,0))
data_idealista = data_idealista %>%
dplyr::mutate(wc2 = ifelse(wc >= 3, "3 or more", wc),
wc2 = ifelse(wc == 2, "2", wc2),
wc2 = ifelse(wc == 1, "1", wc2)
)
data_idealista$wc2 <- factor(x = data_idealista$wc2, levels = c("1","2","3 or more"))
ggplot(data_idealista, aes(log(price))) +
geom_histogram(bins = 50)
ggplot(data_idealista, aes(log(square_mt))) +
geom_histogram(bins = 50)
data_idealista = data_idealista%>%
dplyr::mutate(rooms2 = ifelse(rooms >= 4, "4 or more", rooms),
rooms2 = ifelse(rooms == 3, "3", rooms2),
rooms2 = ifelse(rooms == 2, "2", rooms2),
rooms2 = ifelse(rooms  <= 1, "1", rooms2)
)
data_idealista$rooms2 <- factor(x = data_idealista$rooms2, levels = c("1","2","3","4 or more"))
data_idealista$log_price <- log(data_idealista$price)
data_idealista = data_idealista %>%
mutate(terraza_balcon = ifelse((data_idealista$terraza == 1)|(data_idealista$balcon == 1),1,0))
ggplot(data_idealista,aes(square_mt,price)) +
geom_jitter()
View(data_idealista)
unique(data_idealista$barrio)
unique(data_idealista$regex_barris)
unique(data_idealista$key_shp)
unique(data_idealista$key_open)
View(data_idealista)
source('~/.active-rstudio-document', echo=TRUE)
getwd()
library(tidyverse)
library(here)
library(car)
getwd()
wd = "C:/Users/ggari/Desktop/1_projects/TFM"
wd = "C:/Users/ggari/Desktop/1_projects/TFM"
path_functions = here(wd,"functions","data_mapping.R")
source(path_functions)
path_functions = here(wd,"2_code","2_R_code","functions","data_mapping.R")
source(path_functions)
# Reading data ------------------------------------------------------------
path_data_Ide = "1_data/2_data_Idealista"
path_idealista = here(wd, path_data_Ide,"1_raw","extraction_2022-11-01","datos_scrapping_2022-11-01")
# Reading data ------------------------------------------------------------
path_data_Ide = "1_data/2_data_Idealista"
path_idealista = here(wd, path_data_Ide,"1_raw","extraction_2022-11-01","datos_scrapping_2022-11-01.csv")
data_idealista = read.csv(path_idealista,encoding = "UTF-8")
View(data_idealista)
path_idealista = here(wd,path_data_Ide,"1_raw","extraction_2022-11-17","datos_scrapping_2022-11-19.csv")
path_shp_barcelona = here(wd,"1_data","3_data_Barris_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
data_idealista = read.csv(path_idealista,encoding = "UTF-8")
barcelona_shape <- sf::st_read(path_shp_barcelona)
data_idealista = data_idealista %>%
dplyr::filter(!distrito2 %in% c("Teatinos","Playa de Palma","La Torrasa","Santa Eulàlia"))
# applying the normalization names function
data_idealista = regex_nom_barris(data_idealista,data_idealista$barrio2)
barcelona_shape = regex_nom_barris(barcelona_shape,barcelona_shape$NOM)
# changing some names in Idealista data
data_idealista = data_idealista %>%
mutate(key_open = regex_barris,
# shape_nom_barri = ifelse(barrio_lower == "el gòtic","el barri gòtic",shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "sant pere - santa caterina i la ribera",
#                          "sant pere - santa caterina i la ribera",shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "el poble sec - parc de montjuïc",
#                          "el poble-sec", shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "vila de gràcia", "la vila de gràcia",shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "la marina del port", "la marina del port", shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "vallvidrera - el tibidabo i les planes",
#                          "vallvidrera, el tibidabo i les planes", shape_nom_barri),
# shape_nom_barri = ifelse(barrio_lower == "el besòs", "el besòs i el maresme", shape_nom_barri),
key_open = ifelse(regex_barris == "besòs", "besòs maresme", key_open),
key_open = ifelse(regex_barris == "can peguera turó peira", "can peguera",
key_open), # recuerda que idealista estan juntos, shp dos barrios distintos
key_open = ifelse(regex_barris == "ciutat meridiana torre baró vallbona",
"ciutat meridiana", key_open),
key_open = ifelse(regex_barris ==  "sant genís agudells montbau",
"montbau", key_open),
key_open = ifelse(regex_barris == "vall hebron clota", "vall hebron", key_open),
key_open = ifelse(regex_barris == "poble sec parc montjuïc", "poble sec", key_open)
)
# to connect Idealista data and shp file the key is: key_shp
data_idealista = data_idealista %>%
mutate(key_shp = regex_barris)
data_idealista = data_idealista %>%
dplyr::rename(id = X.U.FEFF.id)
ggplot(data_idealista,aes(square_mt,price)) +
geom_jitter()
# data_idealista = data_idealista[data_idealista$price<70000,]
# data_idealista = data_idealista[data_idealista$price<10000,] # testing
data_idealista = data_idealista[data_idealista$price<7500,] # testing
data_idealista = data_idealista[data_idealista$square_mt>10,] # casa con 0 metros, eliminada
data_idealista = data_idealista[data_idealista$square_mt<375,]
## Adding new binary variables
data_idealista = data_idealista %>%
mutate(casa = ifelse(grepl("Casa o chalet",data_idealista$name)==TRUE,1,0))
data_idealista = data_idealista %>%
mutate(estudio = ifelse(grepl("Estudio",data_idealista$name)==TRUE,1,0))
data_idealista = data_idealista %>%
dplyr::mutate(wc2 = ifelse(wc >= 3, "3 or more", wc),
wc2 = ifelse(wc == 2, "2", wc2),
wc2 = ifelse(wc == 1, "1", wc2)
)
data_idealista$wc2 <- factor(x = data_idealista$wc2, levels = c("1","2","3 or more"))
ggplot(data_idealista, aes(log(price))) +
geom_histogram(bins = 50)
ggplot(data_idealista, aes(log(square_mt))) +
geom_histogram(bins = 50)
data_idealista = data_idealista%>%
dplyr::mutate(rooms2 = ifelse(rooms >= 4, "4 or more", rooms),
rooms2 = ifelse(rooms == 3, "3", rooms2),
rooms2 = ifelse(rooms == 2, "2", rooms2),
rooms2 = ifelse(rooms  <= 1, "1", rooms2)
)
data_idealista$rooms2 <- factor(x = data_idealista$rooms2, levels = c("1","2","3","4 or more"))
data_idealista$log_price <- log(data_idealista$price)
data_idealista = data_idealista %>%
mutate(terraza_balcon = ifelse((data_idealista$terraza == 1)|(data_idealista$balcon == 1),1,0))
ggplot(data_idealista,aes(square_mt,price, col = distrito2)) +
geom_jitter()
ggplot(data_idealista,aes(square_mt,price, col = distrito2)) +
geom_jitter()
write.csv(data_idealista,here(wd, path_data_Ide,"1_clean","idealista_data_clean_2.csv"),
fileEncoding = "UTF-8")
write.csv(data_idealista,here(wd, path_data_Ide,"1_clean"),
fileEncoding = "UTF-8",)
write.csv(data_idealista,here(wd, path_data_Ide,"1_clean","idealista_data_clean_2.csv"),
fileEncoding = "UTF-8",)
write.csv(data_idealista,"C:\Users\ggari\Desktop\1_projects\TFM\1_data\2_data_Idealista\2_clean\idealista_data_clean_2.csv",
fileEncoding = "UTF-8")
write.csv(data_idealista,"C:/Users/ggari/Desktop/1_projects/TFM/1_data/2_data_Idealista/2_clean/idealista_data_clean_2.csv",
fileEncoding = "UTF-8")
getwd()
wd = "C:/Users/ggari/Desktop/1_projects/TFM"
setwd(wd)
path_functions = here(wd,"2_code","2_R_code","functions","data_mapping.R")
source(path_functions)
table_districte = data.frame(codi_districte = c(1:10),
distrito2= c("Distrito Ciutat Vella",
"Distrito Eixample",
"Distrito Sants-Montjuïc",
"Distrito Les Corts",
"Distrito Sarrià-Sant Gervasi",
"Distrito Gràcia",
"Distrito Horta Guinardó",
"Distrito Nou Barris",
"Distrito Sant Andreu",
"Distrito Sant Martí"))
# Reading data ------------------------------------------------------------
path_data_Ide = "1_data/2_data_Idealista"
path_idealista = here(wd,path_data_Ide,"1_clean","idealista_data_clean_2.csv")
# path_shp_barcelona = here(wd,"Barrios_de_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
path_shp_barcelona = here(wd,"1_data","3_data_Barris_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
data_idealista = read.csv(path_idealista,encoding = "UTF-8")
path_idealista = here(wd,path_data_Ide,"2_clean","idealista_data_clean_2.csv")
# path_shp_barcelona = here(wd,"Barrios_de_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
path_shp_barcelona = here(wd,"1_data","3_data_Barris_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
data_idealista = read.csv(path_idealista,encoding = "UTF-8")
barcelona_shape <- sf::st_read(path_shp_barcelona)
mapping = mapIdBarri(barcelona_shape)
mapping = regex_nom_barris(mapping,mapping$barri)
unique(data_idealista$key_shp)
unique(data_idealista$key_open)
data_idealista = left_join(data_idealista,mapping, by=c("key_open" ="regex_barris"))
data_idealista = left_join(data_idealista,table_districte, by="distrito2")
summary(data_idealista)
data_idealista = data_idealista %>% dplyr::filter(!is.na(codi_districte))
data_idealista$id_barri <- as.numeric(data_idealista$id_barri)
summary(data_idealista)
unique((data_idealista %>% dplyr::filter(is.na(id_barri)))$regex_barri)
data_idealista = data_idealista %>% dplyr::filter(!is.na(id_barri))
ggplot(data_idealista,aes(square_mt,price, col = distrito2)) +
geom_jitter()
summary(data_idealista)
files <- list.files(here(wd,"srapper","dataset_opendata"))
read_API_data()
library(tidyverse)
library(here)
library(car)
getwd()
wd = "C:/Users/ggari/Desktop/1_projects/TFM"
setwd(wd)
path_functions = here(wd,"2_code","2_R_code","functions","data_mapping.R")
source(path_functions)
table_districte = data.frame(codi_districte = c(1:10),
distrito2= c("Distrito Ciutat Vella",
"Distrito Eixample",
"Distrito Sants-Montjuïc",
"Distrito Les Corts",
"Distrito Sarrià-Sant Gervasi",
"Distrito Gràcia",
"Distrito Horta Guinardó",
"Distrito Nou Barris",
"Distrito Sant Andreu",
"Distrito Sant Martí"))
# Reading data ------------------------------------------------------------
path_data_Ide = "1_data/2_data_Idealista"
path_idealista = here(wd,path_data_Ide,"2_clean","idealista_data_clean_2.csv")
# path_shp_barcelona = here(wd,"Barrios_de_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
path_shp_barcelona = here(wd,"1_data","3_data_Barris_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
data_idealista = read.csv(path_idealista,encoding = "UTF-8")
barcelona_shape <- sf::st_read(path_shp_barcelona)
mapping = mapIdBarri(barcelona_shape)
mapping = regex_nom_barris(mapping,mapping$barri)
unique(data_idealista$key_shp)
unique(data_idealista$key_open)
data_idealista = left_join(data_idealista,mapping, by=c("key_open" ="regex_barris"))
data_idealista = left_join(data_idealista,table_districte, by="distrito2")
summary(data_idealista)
data_idealista = data_idealista %>% dplyr::filter(!is.na(codi_districte))
data_idealista$id_barri <- as.numeric(data_idealista$id_barri)
summary(data_idealista)
unique((data_idealista %>% dplyr::filter(is.na(id_barri)))$regex_barri)
data_idealista = data_idealista %>% dplyr::filter(!is.na(id_barri))
ggplot(data_idealista,aes(square_mt,price, col = distrito2)) +
geom_jitter()
summary(data_idealista)
files <- list.files(here(wd,"srapper","dataset_opendata"))
read_API_data()
data_idealista = groupingDataOpenData(data_idealista,hospitales,"hospitals")
hospitales = hospitales %>%
dplyr::filter(secondary_filters_name %in% c("Hospitals i clíniques","CAPs","Centres urgències (CUAPs)"))
n_hospital_barri = hospitales %>%
group_by(addresses_neighborhood_id,addresses_neighborhood_name,secondary_filters_name) %>%
count(name = "counts",sort = T)
wider_type = n_hospital_barri %>%
pivot_wider(names_from = secondary_filters_name,values_from = counts,values_fill = 0)
wider_type = wider_type %>%
rename(hospitals = "Hospitals i clíniques",
caps = "CAPs"  ,
cuaps = "Centres urgències (CUAPs)")
# data_idealista$id_barri = as.integer(data_idealista$id_barri)
#
data_idealista = left_join(data_idealista,wider_type,by=c("id_barri" = "addresses_neighborhood_id"))
summary(data_idealista)
colnames(terrazas2)
head(terrazas2)
data_idealista = groupingDataOpenData(data_idealista,terrazas2,"terrazas")
groupingDataOpenData(data_idealista,terrazas2,"terrazas")
summary(data_idealista)
unique(data_idealista[is.na(data_idealista$n_terrazas_barri),]$barri)
rev = terrazas2%>%
group_by(nom_barri,codi_barri)%>%
summarise(mean_cadires_b = mean(cadires),mean_superficie_b=mean(superficie_ocupada),
mean_taules_b = mean(taules)) %>%
arrange(codi_barri)
rev
#
# data_idealista = left_join(data_idealista,n_terrazas_b,by=c("id_barri" = "codi_barri"))
# data_idealista = left_join(data_idealista,n_terrazas_d,by=c("distrito2" = "nom_districte"))
#
data_idealista = left_join(data_idealista,rev,by=c("id_barri" = "codi_barri"))
summary(data_idealista)
colnames(arbres_bcn)
data_idealista = groupingDataOpenData(data_idealista,arbres_bcn,"arbres_bcn")
summary(data_idealista)
data_idealista = groupingDataOpenData(data_idealista,arbres_viaris,"arbres_viaris")
summary(data_idealista)
unique(bar_copas$secondary_filters_name)
bar_copas %>%
group_by(secondary_filters_name)%>%
count() %>%
arrange(-n)
dim(bar_copas)
length(unique(bar_copas$name))
data_idealista = groupingDataOpenData(data_idealista,bar_copas,"bar_copas")
summary(data_idealista)
# Fill all NA with 0 (know that are from the barris/ districtes aggreggation)
data_idealista <- data_idealista %>% replace(is.na(.), 0)
summary(data_idealista)
path_open_data <- "1_data\1_data_API\dataset_opendata"
files <- list.files(here(wd,path_open_data))
path_open_data <- "1_data/1_data_API/dataset_opendata"
files <- list.files(here(wd,path_open_data))
files
library(tidyverse)
library(here)
library(car)
getwd()
wd = "C:/Users/ggari/Desktop/1_projects/TFM"
setwd(wd)
path_functions = here(wd,"2_code","2_R_code","functions","data_mapping.R")
source(path_functions)
table_districte = data.frame(codi_districte = c(1:10),
distrito2= c("Distrito Ciutat Vella",
"Distrito Eixample",
"Distrito Sants-Montjuïc",
"Distrito Les Corts",
"Distrito Sarrià-Sant Gervasi",
"Distrito Gràcia",
"Distrito Horta Guinardó",
"Distrito Nou Barris",
"Distrito Sant Andreu",
"Distrito Sant Martí"))
# Reading data ------------------------------------------------------------
path_data_Ide = "1_data/2_data_Idealista"
path_idealista = here(wd,path_data_Ide,"2_clean","idealista_data_clean_2.csv")
# path_shp_barcelona = here(wd,"Barrios_de_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
path_shp_barcelona = here(wd,"1_data","3_data_Barris_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
data_idealista = read.csv(path_idealista,encoding = "UTF-8")
barcelona_shape <- sf::st_read(path_shp_barcelona)
mapping = mapIdBarri(barcelona_shape)
mapping = regex_nom_barris(mapping,mapping$barri)
unique(data_idealista$key_shp)
unique(data_idealista$key_open)
data_idealista = left_join(data_idealista,mapping, by=c("key_open" ="regex_barris"))
data_idealista = left_join(data_idealista,table_districte, by="distrito2")
summary(data_idealista)
data_idealista = data_idealista %>% dplyr::filter(!is.na(codi_districte))
data_idealista$id_barri <- as.numeric(data_idealista$id_barri)
summary(data_idealista)
unique((data_idealista %>% dplyr::filter(is.na(id_barri)))$regex_barri)
data_idealista = data_idealista %>% dplyr::filter(!is.na(id_barri))
ggplot(data_idealista,aes(square_mt,price, col = distrito2)) +
geom_jitter()
summary(data_idealista)
path_open_data <- "1_data/1_data_API/dataset_opendata"
files <- list.files(here(wd,path_open_data))
read_API_data()
files <- list.files(here(wd,path_open_data))
read_API_data()
read_API_data()
library(tidyverse)
library(here)
library(car)
getwd()
wd = "C:/Users/ggari/Desktop/1_projects/TFM"
setwd(wd)
path_functions = here(wd,"2_code","2_R_code","functions","data_mapping.R")
source(path_functions)
table_districte = data.frame(codi_districte = c(1:10),
distrito2= c("Distrito Ciutat Vella",
"Distrito Eixample",
"Distrito Sants-Montjuïc",
"Distrito Les Corts",
"Distrito Sarrià-Sant Gervasi",
"Distrito Gràcia",
"Distrito Horta Guinardó",
"Distrito Nou Barris",
"Distrito Sant Andreu",
"Distrito Sant Martí"))
# Reading data ------------------------------------------------------------
path_data_Ide = "1_data/2_data_Idealista"
path_idealista = here(wd,path_data_Ide,"2_clean","idealista_data_clean_2.csv")
# path_shp_barcelona = here(wd,"Barrios_de_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
path_shp_barcelona = here(wd,"1_data","3_data_Barris_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
data_idealista = read.csv(path_idealista,encoding = "UTF-8")
barcelona_shape <- sf::st_read(path_shp_barcelona)
mapping = mapIdBarri(barcelona_shape)
mapping = regex_nom_barris(mapping,mapping$barri)
unique(data_idealista$key_shp)
unique(data_idealista$key_open)
data_idealista = left_join(data_idealista,mapping, by=c("key_open" ="regex_barris"))
data_idealista = left_join(data_idealista,table_districte, by="distrito2")
summary(data_idealista)
data_idealista = data_idealista %>% dplyr::filter(!is.na(codi_districte))
data_idealista$id_barri <- as.numeric(data_idealista$id_barri)
summary(data_idealista)
unique((data_idealista %>% dplyr::filter(is.na(id_barri)))$regex_barri)
data_idealista = data_idealista %>% dplyr::filter(!is.na(id_barri))
ggplot(data_idealista,aes(square_mt,price, col = distrito2)) +
geom_jitter()
summary(data_idealista)
path_open_data <- "1_data/1_data_API/dataset_opendata"
files <- list.files(here(wd,path_open_data))
read_API_data()
path_open_data <- "1_data/1_data_API/dataset_opendata"
files <- list.files(here(wd,path_open_data))
read_API_data()
library(tidyverse)
library(here)
library(car)
getwd()
wd = "C:/Users/ggari/Desktop/1_projects/TFM"
setwd(wd)
path_functions = here(wd,"2_code","2_R_code","functions","data_mapping.R")
source(path_functions)
table_districte = data.frame(codi_districte = c(1:10),
distrito2= c("Distrito Ciutat Vella",
"Distrito Eixample",
"Distrito Sants-Montjuïc",
"Distrito Les Corts",
"Distrito Sarrià-Sant Gervasi",
"Distrito Gràcia",
"Distrito Horta Guinardó",
"Distrito Nou Barris",
"Distrito Sant Andreu",
"Distrito Sant Martí"))
# Reading data ------------------------------------------------------------
path_data_Ide = "1_data/2_data_Idealista"
path_idealista = here(wd,path_data_Ide,"2_clean","idealista_data_clean_2.csv")
# path_shp_barcelona = here(wd,"Barrios_de_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
path_shp_barcelona = here(wd,"1_data","3_data_Barris_Barcelona","0301040100_Barris_ADM_ETRS89.shp")
data_idealista = read.csv(path_idealista,encoding = "UTF-8")
barcelona_shape <- sf::st_read(path_shp_barcelona)
mapping = mapIdBarri(barcelona_shape)
mapping = regex_nom_barris(mapping,mapping$barri)
unique(data_idealista$key_shp)
unique(data_idealista$key_open)
data_idealista = left_join(data_idealista,mapping, by=c("key_open" ="regex_barris"))
data_idealista = left_join(data_idealista,table_districte, by="distrito2")
summary(data_idealista)
data_idealista = data_idealista %>% dplyr::filter(!is.na(codi_districte))
data_idealista$id_barri <- as.numeric(data_idealista$id_barri)
summary(data_idealista)
unique((data_idealista %>% dplyr::filter(is.na(id_barri)))$regex_barri)
data_idealista = data_idealista %>% dplyr::filter(!is.na(id_barri))
ggplot(data_idealista,aes(square_mt,price, col = distrito2)) +
geom_jitter()
summary(data_idealista)
path_open_data <- "1_data/1_data_API/dataset_opendata"
files <- list.files(here(wd,path_open_data))
read_API_data()
read_API_data()
files <- list.files(here(wd,path_open_data))
files
read_API_data()
source(path_functions)
files <- list.files(here(wd,path_open_data))
read_API_data()
source(path_functions)
source(path_functions)
read_API_data()
source(path_functions)
read_API_data()
source(path_functions)
read_API_data()
data_idealista = groupingDataOpenData(data_idealista,hospitales,"hospitals")
hospitales = hospitales %>%
dplyr::filter(secondary_filters_name %in% c("Hospitals i clíniques","CAPs","Centres urgències (CUAPs)"))
n_hospital_barri = hospitales %>%
group_by(addresses_neighborhood_id,addresses_neighborhood_name,secondary_filters_name) %>%
count(name = "counts",sort = T)
wider_type = n_hospital_barri %>%
pivot_wider(names_from = secondary_filters_name,values_from = counts,values_fill = 0)
wider_type = wider_type %>%
rename(hospitals = "Hospitals i clíniques",
caps = "CAPs"  ,
cuaps = "Centres urgències (CUAPs)")
# data_idealista$id_barri = as.integer(data_idealista$id_barri)
#
data_idealista = left_join(data_idealista,wider_type,by=c("id_barri" = "addresses_neighborhood_id"))
summary(data_idealista)
colnames(terrazas2)
head(terrazas2)
data_idealista = groupingDataOpenData(data_idealista,terrazas2,"terrazas")
groupingDataOpenData(data_idealista,terrazas2,"terrazas")
summary(data_idealista)
unique(data_idealista[is.na(data_idealista$n_terrazas_barri),]$barri)
rev = terrazas2%>%
group_by(nom_barri,codi_barri)%>%
summarise(mean_cadires_b = mean(cadires),mean_superficie_b=mean(superficie_ocupada),
mean_taules_b = mean(taules)) %>%
arrange(codi_barri)
rev
#
# data_idealista = left_join(data_idealista,n_terrazas_b,by=c("id_barri" = "codi_barri"))
# data_idealista = left_join(data_idealista,n_terrazas_d,by=c("distrito2" = "nom_districte"))
#
data_idealista = left_join(data_idealista,rev,by=c("id_barri" = "codi_barri"))
summary(data_idealista)
colnames(arbres_bcn)
data_idealista = groupingDataOpenData(data_idealista,arbres_bcn,"arbres_bcn")
summary(data_idealista)
data_idealista = groupingDataOpenData(data_idealista,arbres_viaris,"arbres_viaris")
summary(data_idealista)
unique(bar_copas$secondary_filters_name)
bar_copas %>%
group_by(secondary_filters_name)%>%
count() %>%
arrange(-n)
dim(bar_copas)
length(unique(bar_copas$name))
data_idealista = groupingDataOpenData(data_idealista,bar_copas,"bar_copas")
summary(data_idealista)
# Fill all NA with 0 (know that are from the barris/ districtes aggreggation)
data_idealista <- data_idealista %>% replace(is.na(.), 0)
summary(data_idealista)
saveRDS(data_idealista,file="C:\Users\ggari\Desktop\1_projects\TFM\1_data\2_data_Idealista")
saveRDS(data_idealista,file="C:/Users/ggari/Desktop/1_projects/TFM/1_data/2_data_Idealista")
saveRDS(data_idealista,file="C:/Users/ggari/Desktop/1_projects/TFM/1_data/2_data_Idealista/data_modelling.RDS")
